# 有償Webアプリ化への移行ガイド（ドラフト）

対象: 当面は Docker + ローカル実行。将来的に有償Webアプリとして提供するための準備チェックリスト。

## 1. プロダクト方針の分離

- セキュリティ方針 -> `SECURITY.md`
- ライセンス/エディション方針 -> `LICENSING.md`
- README から上記にリンク

## 2. 既定値の安全化（段階的）

- 認証
  - Phase A: `PYFLOWS_API_TOKEN` を明示設定時のみ保護（現状）
  - Phase B: コンテナ起動時にランダムトークン自動生成＋コンソール出力
  - Phase C: 非ローカルバインド/本番フラグ時はトークン必須
- CORS
  - Phase A: デフォルト許可（現状）
  - Phase B: 起動引数/ENVで許可ドメインを必須（本番）
- 実行制御
  - `PYFLOWS_EXEC_TIMEOUT` の既定短縮、`PYFLOWS_EXPORT_MAX_ROWS` の上限明記

## 3. 機能ゲーティング

- `verify_license_for_feature(feature)` を重要エンドポイント/処理に適用
- 例: リモートカーネル接続、ダウンロード上限、特定ノード群、保存先バックエンド

## 4. インフラ/デプロイ

- 逆プロキシ（TLS, HSTS, 圧縮, レート制限）
- ログ/メトリクス（実行成功率、遅延、メモリ）
- Jupyter Enterprise Gateway（ユーザー隔離、クォータ）
- ストレージ: フロー/アップロードの外部ストレージ化（S3/Blob等）

## 5. 管理者機能（将来）

- 管理API/UI: ユーザー/RBAC、監査ログ、ライセンス状態
- テナント分離: データ/ランタイム/設定スコープ

## 6. UI/UX（最優先）

- 初回起動ツアー、エラーの具体化、プレビュー安定化
- 変数インスペクタのフィルタ/検索、履歴、サンプル上限の視覚化
- フローの保存/共有UX（名前の自動補完、重複警告）

## 7. ロードマップ例

- 0.x: ローカルCE、ドキュメント整備、既定値改善
- 1.0: Pro（認証/CORS/隔離/上限拡張）、JEG連携
- 1.x: Enterprise（RBAC/監査/マルチテナント/サポート）

## 8. 互換性ポリシー（案）

- REST/WSの後方互換を原則維持（BreakingはMAJORで）
- ノード仕様のバージョニング（runtime schema version）

本ガイドはドラフトです。詳細仕様は別ドキュメントで確定します。