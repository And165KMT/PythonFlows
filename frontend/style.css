:root {
  --bg: #0e1116; --panel: #161b22; --text: #e6edf3; --sub: #9ba3af;
  --accent: #1f6feb; --ok: #2ea043; --warn: #d29922; --err: #f85149;
  --right-w: 380px;
}
html, body { height: 100%; }
body { margin: 0; font-family: -apple-system, Segoe UI, Roboto, sans-serif; background: var(--bg); color: var(--text); }
header { padding: 12px 16px; background: #0b0f14; border-bottom: 1px solid #1f2329; display:flex; align-items:center; gap:12px; }
header h1 { margin: 0; font-size: 18px; }
#app { display: grid; grid-template-columns: 260px 1fr var(--right-w); height: calc(100% - 53px); }
#sidebar { background: var(--panel); border-right:1px solid #1f2329; padding: 12px; }
#canvasWrap { position: relative; background: #0c1016; }
#right { background: var(--panel); border-left:1px solid #1f2329; display:flex; flex-direction:column; position: relative; }
#rightResizer { position:absolute; left:-3px; top:0; bottom:0; width:6px; cursor: col-resize; background: transparent; }
#rightResizer:hover { background: rgba(255,255,255,0.05); }
#toolbar button { width: 100%; margin-bottom: 8px; padding: 8px; background:#111824; color:var(--text); border:1px solid #263041; border-radius:6px; cursor:pointer; text-align:left; }
#toolbar button:hover { background:#152032; }
#actions { display:flex; gap:8px; margin-top:12px; }
#actions button { flex:1; padding:8px; background:var(--accent); color:white; border:0; border-radius:6px; cursor:pointer; }
#actions button.secondary { background:#263041; }
#actions button.warn { background: var(--warn); color:#111; }

/* Nodes */
.node { position:absolute; background:#0f1520; border:1px solid #2a3445; border-radius:8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
.node .head { padding:8px 10px; background:#111827; border-bottom:1px solid #263041; display:flex; align-items:center; justify-content:space-between; cursor: move; }
.node .type { font-size:12px; color:var(--sub); }
.node .title { font-weight:600; }
.node .body { padding:8px 10px; display:flex; flex-direction:column; gap:6px; }
.node label { font-size:12px; color:var(--sub); }
.node input, .node select, .node textarea { width:100%; background:#0b1018; color:var(--text); border:1px solid #2a3445; border-radius:6px; padding:6px; font-size:12px; }
.node textarea { height:70px; font-family: ui-monospace, Consolas, monospace; }
/* Node action bar */
.node .actions { display:flex; gap:6px; padding:8px 10px; border-top:1px solid #263041; }
.node .actions .btn-primary { flex:1; background: var(--accent); color:#fff; border:0; border-radius:8px; padding:6px 8px; cursor:pointer; }
.node .actions .btn-primary:hover { filter: brightness(1.1); }
.node .actions .btn-icon { width:32px; height:32px; display:inline-flex; align-items:center; justify-content:center; background:#111824; color:var(--sub); border:1px solid #2a3445; border-radius:8px; cursor:pointer; }
.node .actions .btn-icon svg { width:18px; height:18px; }
.node .actions .btn-icon:hover { background:#152032; color:#fff; border-color:#3b82f6; }
.node .actions .btn-icon:focus-visible { outline:2px solid #3b82f6; outline-offset:2px; }
.node .actions .btn-icon.danger { background:#1a0f11; color:#f2b4b6; border-color:#3a1f21; }
.node .actions .btn-icon.danger:hover { background:#2a1216; color:#fff; border-color: var(--err); }
/* Drag-and-drop highlight for inputs */
.node input.dnd-hover, .node textarea.dnd-hover { outline: 2px dashed #1f6feb; outline-offset: 2px; }
.node.selected { border:2px solid #3b82f6; box-shadow: 0 0 0 2px rgba(59,130,246,0.65), 0 6px 16px rgba(59,130,246,0.25); }
.port { width:12px; height:12px; border-radius:50%; background: #44546a; border:1px solid #2a3445; cursor: crosshair; box-shadow: 0 0 0 4px rgba(0,0,0,0); transition: box-shadow .1s; }
.port.selected { box-shadow: 0 0 0 4px rgba(31,111,235,0.35); }
.ports { display:flex; align-items:center; justify-content:space-between; padding:6px 10px; }
/* Colors: out=blue, in=green (start from blue out, connect to green in) */
.port.out { background: #1f6feb; }
.port.in { background: #2ea043; }
.preview { border-top:1px solid #263041; padding:8px 10px; max-height:140px; overflow:auto; background:#0b0f14; }
.preview img { max-width:100%; height:auto; display:block; }
/* Node resize handles */
.node-resize-h { position:absolute; right:-3px; top:0; bottom:0; width:6px; cursor: ew-resize; background: transparent; border-radius: 0 8px 8px 0; }
.node-resize-h:hover { background: rgba(255,255,255,0.06); }
.node-resize-v { position: sticky; display:block; height:6px; margin:6px -10px -8px -10px; bottom:0; cursor: ns-resize; background: transparent; border-top:1px dashed #263041; }
.node.selected .node-resize-h, .node:hover .node-resize-h { background: rgba(255,255,255,0.04); }
/* Edges */
#edges { position:absolute; inset:0; pointer-events:none; width:100%; height:100%; }
.edge { stroke:#3b82f6; stroke-width:2; fill:none; }
/* Right panel */
#log { white-space: pre-wrap; background: #0b0f14; color: #a7f3d0; padding: 8px; height: 280px; overflow: auto; border-top:1px solid #1f2329; }
#genCode { background:#0b0f14; color:#c9d1d9; border:0; border-top:1px solid #1f2329; padding:10px; font-family: ui-monospace, Consolas, monospace; height:100%; overflow:auto; }

/* Group frame collapsed state */
.group-frame.collapsed{ background: rgba(31,111,235,0.03); border:2px dotted #385a9a; }

/* Right panel tabs */
.tabs { display:inline-flex; background:#111824; border:1px solid #263041; border-radius:8px; overflow:hidden; }
.tab { padding:6px 12px; background:transparent; color:var(--text); border:0; cursor:pointer; font-weight:600; font-size:12px; }
.tab:hover { background:#152032; }
.tab.active { background: var(--accent); color:#fff; }

/* Variable chips (drag affordance) */
#rightVars .var-item { display:inline-flex; align-items:center; gap:6px; padding:4px 8px; border:1px dashed #3b82f6; border-radius:999px; background:#0b1220; color:var(--text); cursor: grab; user-select:none; }
#rightVars .var-item:active { cursor: grabbing; }
#rightVars .var-item .drag-handle { width:14px; height:14px; opacity:0.7; }
#rightVars .var-item:hover { background:#0f1729; border-color:#60a5fa; }
#rightVars .var-item.dragging { outline:2px solid #60a5fa; }
#rightVars .var-label { font-weight:600; }
